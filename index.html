<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>કારિગાર ઉપાડ યાદી | Karigar Upad Yadi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Noto+Sans+Gujarati:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    @font-face { font-family: 'Poppins'; src: local('Poppins'), local('Nunito'), sans-serif; }
    @font-face { font-family: 'Shruti'; src: local('Shruti'), local('Noto Sans Gujarati'), sans-serif; }
    @font-face { font-family: 'Noto Sans Devanagari'; src: local('Noto Sans Devanagari'), sans-serif; }
    
    :root {
      --brand-blue: #2563eb;
      --brand-dark: #1e40af;
      --brand-light: #f7fafd;
      --accent-green: #10b981;
      --accent-red: #ef4444;
      --accent-orange: #f59e0b;
      --card-bg: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border: #e2e8f0;
      --transition-fast: 0.18s cubic-bezier(.78,.06,.31,.91);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', 'Nunito', system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 15px;
      transition: background 0.22s;
    }
    
    body.dark {
      background: linear-gradient(135deg, #1a1f3a 0%, #2d1f42 100%);
      color: #f1f5f9;
    }
    
    body.dark .container { 
      background: #1e2742; 
      color: #f1f5f9; 
      border: 1px solid #334155;
    }
    body.dark .card, body.dark .stat-card { 
      background: #334155; 
      color: #f1f5f9;
      border: 1px solid #475569;
    }
    body.dark .worker-card { 
      background: #334155; 
      border-color: #475569;
      color: #f1f5f9;
    }
    body.dark input, body.dark select, body.dark textarea { 
      background: #334155; 
      color: #f1f5f9; 
      border-color: #475569;
    }
    body.dark .tab-btn {
      background: #334155;
      color: #f1f5f9;
      border: 1px solid #475569;
    }
    body.dark .tab-btn.active {
      background: var(--brand-blue);
      color: white;
    }
    body.dark .transaction-table {
      background: #334155;
      color: #f1f5f9;
    }
    body.dark .transaction-table th {
      background: #475569;
      color: #f1f5f9;
    }
    body.dark .transaction-table td {
      color: #f1f5f9;
      border-color: #475569;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      overflow: hidden;
      animation: fadeInScale 0.5s cubic-bezier(.22,.36,.31,.91);
    }
    
    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(0.95) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    
    .app-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 24px 20px;
      text-align: center;
      position: relative;
    }
    
    .app-header h1 {
      font-size: clamp(22px, 5vw, 32px);
      font-weight: 700;
      margin-bottom: 6px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .app-header p {
      font-size: clamp(13px, 3vw, 16px);
      opacity: 0.92;
    }
    
    .lang-theme-switcher {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
    }
    
    #language-switcher {
      font-size: 15px;
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.25);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    
    #theme-toggle {
      font-size: 22px;
      background: rgba(255,255,255,0.25);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #theme-toggle:active { transform: scale(0.92); }
    
    .tabs {
      display: flex;
      background: var(--brand-light);
      padding: 10px;
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: thin;
    }
    
    .tab-btn {
      flex: 1;
      min-width: 110px;
      padding: 14px 16px;
      border: none;
      background: var(--card-bg);
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.25s;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .tab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(37, 99, 235, 0.2);
    }
    
    .tab-btn.active {
      background: var(--brand-blue);
      color: white;
      box-shadow: 0 4px 16px rgba(37, 99, 235, 0.35);
    }
    
    .tab-content {
      display: none;
      padding: 24px 18px;
      animation: fadeIn 0.35s;
    }
    
    .tab-content.active { display: block; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-bottom: 26px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-dark) 100%);
      color: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(37, 99, 235, 0.2);
      transition: transform 0.2s;
    }
    
    .stat-card:hover { transform: translateY(-3px); }
    
    .stat-card.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .stat-card.danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .stat-card.warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    .stat-label {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 6px;
    }
    
    .stat-value {
      font-size: clamp(24px, 5vw, 32px);
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 7px;
      color: var(--text-primary);
      font-size: 15px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 13px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.25s;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    button, .btn {
      padding: 13px 24px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      font-family: inherit;
    }
    
    button:hover, .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.18);
    }
    
    button:active, .btn:active {
      transform: translateY(0);
    }
    
    .btn-primary {
      background: var(--brand-blue);
      color: white;
    }
    
    .btn-success {
      background: var(--accent-green);
      color: white;
    }
    
    .btn-danger {
      background: var(--accent-red);
      color: white;
    }
    
    .btn-secondary {
      background: var(--text-secondary);
      color: white;
    }
    
    .btn-warning {
      background: var(--accent-orange);
      color: white;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    
    .search-box {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      margin-bottom: 18px;
      font-family: inherit;
      transition: all 0.25s;
    }
    
    .search-box:focus {
      outline: none;
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .worker-list {
      display: grid;
      gap: 14px;
      margin-top: 18px;
    }
    
    .worker-card {
      background: var(--brand-light);
      padding: 18px;
      border-radius: 16px;
      border: 2px solid var(--border);
      transition: all 0.25s;
      cursor: pointer;
      animation: fadeInCard 0.5s;
    }
    
    @keyframes fadeInCard {
      0% { opacity: 0; transform: translateY(15px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    
    .worker-card:hover {
      border-color: var(--brand-blue);
      box-shadow: 0 6px 24px rgba(37, 99, 235, 0.15);
      transform: translateY(-2px);
    }
    
    .worker-card h3 {
      color: var(--brand-blue);
      margin-bottom: 10px;
      font-size: 19px;
    }
    
    .worker-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }
    
    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 9px;
      background: white;
      border-radius: 9px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    
    .info-label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .info-value {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .transaction-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 18px;
      background: white;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .transaction-table th,
    .transaction-table td {
      padding: 13px;
      text-align: left;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }
    
    .transaction-table th {
      background: var(--brand-blue);
      color: white;
      font-weight: 600;
    }
    
    .transaction-table tr:hover {
      background: var(--brand-light);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      animation: fadeIn 0.3s;
    }
    
    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .modal-content {
      background: white;
      padding: 26px;
      border-radius: 20px;
      max-width: 650px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.35s;
    }
    
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    
    .modal-header h2 {
      color: var(--brand-blue);
      font-size: 24px;
    }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 32px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: var(--border);
    }
    
    .badge {
      display: inline-block;
      padding: 6px 13px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }
    
    .badge.success {
      background: #d1fae5;
      color: #065f46;
    }
    
    .badge.danger {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .badge.warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 16px;
      margin-top: 18px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    
    .bar-chart {
      display: flex;
      align-items: flex-end;
      height: 240px;
      gap: 12px;
      margin-top: 18px;
      padding: 18px 0;
    }
    
    .bar {
      flex: 1;
      background: linear-gradient(to top, var(--brand-blue), var(--brand-dark));
      border-radius: 10px 10px 0 0;
      position: relative;
      transition: all 0.3s;
      min-height: 25px;
    }
    
    .bar:hover {
      opacity: 0.85;
      transform: translateY(-4px);
    }
    
    .bar-label {
      position: absolute;
      bottom: -28px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .bar-value {
      position: absolute;
      top: -24px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      font-weight: 700;
      color: var(--brand-blue);
    }
    
    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--text-secondary);
    }
    
    .empty-state h3 {
      margin-top: 12px;
      margin-bottom: 8px;
    }
    
    #add-worker-fab {
      position: fixed;
      right: 20px;
      bottom: 24px;
      background: var(--accent-green);
      color: #fff;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
      font-size: 32px;
      border: none;
      z-index: 99;
      cursor: pointer;
      transition: all 0.25s;
    }
    
    #add-worker-fab:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.5);
    }
    
    #add-worker-fab:active {
      transform: scale(0.95);
    }
    
    .app-footer {
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      color: #fff;
      text-align: center;
      padding: 30px 20px;
      font-size: 1rem;
      margin-top: 40px;
    }
    
    body.dark .app-footer {
      background: linear-gradient(135deg, #1e2742 0%, #334155 100%);
    }
    
    .brand-footer {
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .footer-brand {
      font-weight: 600;
      font-size: 1.1rem;
    }
    
    .footer-links {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }
    
    .footer-watermark {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 10px;
    }
    
    #live-clock {
      font-family: 'Courier New', monospace;
      font-size: 15px;
      background: rgba(255,255,255,0.15);
      color: #fff;
      padding: 4px 14px;
      border-radius: 8px;
      margin-top: 8px;
      display: inline-block;
    }
    
    /* Notification System */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fff;
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      z-index: 10000;
      transform: translateX(400px);
      transition: transform 0.3s ease-out;
      border-left: 4px solid var(--brand-blue);
      max-width: 350px;
      min-width: 300px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      border-left-color: var(--accent-green);
    }
    
    .notification.error {
      border-left-color: var(--accent-red);
    }
    
    .notification.warning {
      border-left-color: #f59e0b;
    }
    
    .notification-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .notification-icon {
      font-size: 1.2rem;
    }
    
    .notification-message {
      flex: 1;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .notification-close {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #666;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    
    .notification-close:hover {
      background: #f1f5f9;
    }
    
    body.dark .notification {
      background: #334155;
      color: #f1f5f9;
    }
    
    body.dark .notification-message {
      color: #f1f5f9;
    }
    
    body.dark .notification-close {
      color: #94a3b8;
    }
    
    body.dark .notification-close:hover {
      background: #475569;
    }
    
    .loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    
    .loader.active { display: flex; }
    
    .loader .spinner {
      font-size: 28px;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(90deg, var(--brand-blue), var(--accent-green));
      padding: 22px 40px;
      border-radius: 16px;
      box-shadow: 0 4px 32px rgba(37, 99, 235, 0.6);
      animation: pulse 1s infinite alternate;
    }
    
    @keyframes pulse {
      to { transform: scale(1.05); opacity: 0.9; }
    }
    
    @media (max-width: 768px) {
      .app-header h1 { font-size: 22px; }
      .tabs { overflow-x: scroll; }
      .tab-btn { min-width: 100px; padding: 12px 14px; font-size: 14px; }
      .stat-value { font-size: 24px; }
      .modal-content { padding: 18px; }
      .action-buttons { flex-direction: column; }
      .action-buttons button { width: 100%; }
      .transaction-table th, .transaction-table td { padding: 10px 8px; font-size: 13px; }
    }
    
    @media print {
      body * { visibility: hidden; }
      .print-section, .print-section * { visibility: visible; }
      .print-section { position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>

<body>
  <div class="loader" id="loadAnim">
    <span class="spinner">⚡ Loading...</span>
  </div>
  
  <div class="container">
    <header class="app-header">
      <h1 id="app-title">કારિગાર ઉપાડ યાદી</h1>
      <p id="app-subtitle">Karigar Upad Yadi | कर्मचारी उधार सूची</p>
      <div class="lang-theme-switcher">
        <select id="language-switcher" aria-label="Switch Language">
          <option value="en">English</option>
          <option value="gu">ગુજરાતી</option>
          <option value="hi">हिन्दी</option>
        </select>
        <button id="theme-toggle" title="Light/Dark Mode">🌙</button>
      </div>
    </header>
    
    <nav class="tabs">
      <button class="tab-btn active" onclick="showTab('dashboard')">📊 Dashboard</button>
      <button class="tab-btn" onclick="showTab('workers')">👷 Workers</button>
      <button class="tab-btn" onclick="showTab('addWorker')">➕ Add</button>
      <button class="tab-btn" onclick="showTab('lendMoney')">💰 Lend</button>
      <button class="tab-btn" onclick="showTab('receiveMoney')">✅ Receive</button>
      <button class="tab-btn" onclick="showTab('deduct')">🔻 Deduct</button>
      <button class="tab-btn" onclick="showTab('reports')">📄 Reports</button>
      <button class="tab-btn" onclick="showTab('exchange')">🔄 Data</button>
    </nav>
    
    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Workers</div>
          <div class="stat-value" id="totalWorkers">0</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Total Lent (₹)</div>
          <div class="stat-value" id="totalLent">0</div>
        </div>
        <div class="stat-card danger">
          <div class="stat-label">Pending (₹)</div>
          <div class="stat-value" id="totalPending">0</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Received (₹)</div>
          <div class="stat-value" id="totalReceived">0</div>
        </div>
      </div>
      
      <div class="chart-container">
        <h2>Top 5 Workers by Pending Amount</h2>
        <div class="bar-chart" id="topWorkersChart"></div>
      </div>
      
      <div class="chart-container">
        <h2>Recent Transactions</h2>
        <table class="transaction-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Worker</th>
              <th>Type</th>
              <th>Amount (₹)</th>
            </tr>
          </thead>
          <tbody id="recentTransactions"></tbody>
        </table>
      </div>
    </div>
    
    <!-- Workers Tab -->
    <div id="workers" class="tab-content">
      <input type="text" class="search-box" id="searchWorker" placeholder="🔍 Search worker by name, phone..." onkeyup="filterWorkers()">
      <div class="worker-list" id="workerList"></div>
    </div>
    
    <!-- Add Worker Tab -->
    <div id="addWorker" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Add New Worker</h2>
      
      <div class="form-group">
        <label>Worker Name *</label>
        <input type="text" id="workerName" placeholder="Enter worker name" required>
      </div>
      
      <div class="form-group">
        <label>Phone Number *</label>
        <input type="tel" id="workerPhone" placeholder="Enter phone number" required>
      </div>
      
      <div class="form-group">
        <label>Address</label>
        <textarea id="workerAddress" placeholder="Enter address" rows="3"></textarea>
      </div>
      
      <div class="form-group">
        <label>ID Proof Type</label>
        <select id="idProofType">
          <option value="">Select ID proof</option>
          <option value="Aadhar">Aadhar Card</option>
          <option value="PAN">PAN Card</option>
          <option value="Voter">Voter ID</option>
          <option value="Driving">Driving License</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>ID Number</label>
        <input type="text" id="idNumber" placeholder="Enter ID number">
      </div>
      
      <div class="form-group">
        <label>Notes</label>
        <textarea id="workerNotes" placeholder="Additional notes" rows="3"></textarea>
      </div>
      
      <button class="btn btn-primary" onclick="addWorker()">Add Worker</button>
    </div>
    
    <!-- Lend Money Tab -->
    <div id="lendMoney" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Lend Money to Worker</h2>
      
      <div class="form-group">
        <label>Select Worker *</label>
        <select id="lendWorkerSelect" required>
          <option value="">Choose a worker...</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Amount (₹) *</label>
        <input type="number" id="lendAmount" placeholder="Enter amount" required min="1">
      </div>
      
      <div class="form-group">
        <label>Date of Lending *</label>
        <input type="date" id="lendDate" required>
      </div>
      
      <div class="form-group">
        <label>Due Date (Optional)</label>
        <input type="date" id="lendDueDate">
      </div>
      
      <div class="form-group">
        <label>Purpose</label>
        <input type="text" id="lendPurpose" placeholder="Reason for lending">
      </div>
      
      <div class="form-group">
        <label>Notes</label>
        <textarea id="lendNotes" placeholder="Additional notes" rows="3"></textarea>
      </div>
      
      <button class="btn btn-success" onclick="lendMoney()">Lend Money</button>
    </div>
    
    <!-- Receive Money Tab -->
    <div id="receiveMoney" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Receive Money from Worker</h2>
      
      <div class="form-group">
        <label>Select Worker *</label>
        <select id="receiveWorkerSelect" required onchange="showWorkerBalance()">
          <option value="">Choose a worker...</option>
        </select>
      </div>
      
      <div id="balanceInfo" style="display: none; background: var(--brand-light); padding: 16px; border-radius: 12px; margin-bottom: 18px;">
        <div style="font-weight: 600; color: var(--text-primary);">Pending Balance: ₹<span id="workerBalance">0</span></div>
      </div>
      
      <div class="form-group">
        <label>Amount Received (₹) *</label>
        <input type="number" id="receiveAmount" placeholder="Enter amount received" required min="1">
      </div>
      
      <div class="form-group">
        <label>Date of Receipt *</label>
        <input type="date" id="receiveDate" required>
      </div>
      
      <div class="form-group">
        <label>Payment Method</label>
        <select id="paymentMethod">
          <option value="Cash">Cash</option>
          <option value="Bank Transfer">Bank Transfer</option>
          <option value="UPI">UPI</option>
          <option value="Cheque">Cheque</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Notes</label>
        <textarea id="receiveNotes" placeholder="Additional notes" rows="3"></textarea>
      </div>
      
      <button class="btn btn-success" onclick="receiveMoney()">Receive Money</button>
    </div>
    
    <!-- Deduct Tab -->
    <div id="deduct" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Deduct/Adjust Amount</h2>
      
      <div class="form-group">
        <label>Select Worker *</label>
        <select id="deductWorkerSelect" required>
          <option value="">Choose a worker...</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Amount (₹) *</label>
        <input type="number" id="deductAmount" placeholder="Enter amount" required min="1">
      </div>
      
      <div class="form-group">
        <label>Date *</label>
        <input type="date" id="deductDate" required>
      </div>
      
      <div class="form-group">
        <label>Deduction Type</label>
        <select id="deductOpt">
          <option value="decrease">Decrease balance (forgive/waive)</option>
          <option value="increase">Increase balance (additional charges)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Reason</label>
        <textarea id="deductNote" placeholder="Reason for adjustment" rows="3"></textarea>
      </div>
      
      <button class="btn btn-warning" onclick="doDeduct()">Apply Adjustment</button>
    </div>
    
    <!-- Reports Tab -->
    <div id="reports" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Generate Reports</h2>
      
      <div class="form-group">
        <label>Report Type</label>
        <select id="reportType">
          <option value="all">All Workers Summary</option>
          <option value="single">Single Worker Report</option>
          <option value="pending">Workers with Pending Amount</option>
          <option value="transactions">All Transactions</option>
        </select>
      </div>
      
      <div class="form-group" id="singleWorkerReport" style="display: none;">
        <label>Select Worker</label>
        <select id="reportWorkerSelect">
          <option value="">Choose a worker...</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Date Range (Optional)</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <input type="date" id="reportFromDate" placeholder="From">
          <input type="date" id="reportToDate" placeholder="To">
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="generateReport()">📄 View Report</button>
        <button class="btn btn-success" onclick="printReport()">🖨️ Print</button>
        <button class="btn btn-secondary" onclick="downloadPDF()">📥 PDF</button>
      </div>
      
      <div id="reportContent" style="margin-top: 24px;"></div>
    </div>
    
    <!-- Exchange Tab -->
    <div id="exchange" class="tab-content">
      <h2 style="margin-bottom: 18px; color: var(--brand-blue);">Import/Export Data</h2>
      
      <p style="color: var(--text-secondary); margin-bottom: 20px;">
        Backup your data or transfer to another device using JSON format. All data is compatible across devices.
      </p>
      
      <div class="action-buttons">
        <button class="btn btn-success" onclick="exportJSON()">📤 Export JSON</button>
        <button class="btn btn-primary" onclick="document.getElementById('importFile').click()">📥 Import JSON</button>
        <button class="btn btn-secondary" onclick="exportCSV()">📊 Export CSV</button>
        <button class="btn btn-danger" onclick="clearAllData()">🗑️ Clear All Data</button>
      </div>
      
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)">
      
      <div id="exchangeMsg" style="margin-top: 18px; padding: 14px; border-radius: 10px; display: none;"></div>
    </div>
  </div>
  
  <!-- Worker Details Modal -->
  <div class="modal" id="workerModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Worker Details</h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div id="modalContent"></div>
    </div>
  </div>
  
  <!-- FAB Button -->
  <button id="add-worker-fab" onclick="quickAddWorker()" title="Add Worker">＋</button>
  
  <!-- Footer -->
  <footer class="app-footer">
    <div class="brand-footer">
      <div class="footer-content">
        <div class="footer-brand">
        
        </div>
        <div class="footer-links">
          <span>Made by Ved Mangukiya</span>
          <span>© 2025 All Rights Reserved</span>
        </div>
        <div id="live-clock"></div>
      </div>
    </div>
    <div class="footer-watermark">
      Professional Worker Money Lending Management System
    </div>
  </footer>
  
  <!-- Print Section -->
  <div class="print-section" id="printSection"></div>
  
  <script>
    // ===== CONFIGURATION =====
    const STORAGE_KEY = 'karigar-Upad-yadi-v3';
    const LANG_KEY = 'karigar-lang';
    const THEME_KEY = 'karigar-theme';
    
    const LANGS = {
      en: { name: "English", font: "'Poppins', sans-serif", title: "Karigar Upad Yadi" },
      gu: { name: "ગુજરાતી", font: "'Noto Sans Gujarati', sans-serif", title: "કારિગાર ઉપાડ યાદી" },
      hi: { name: "हिंदी", font: "'Noto Sans Devanagari', sans-serif", title: "कर्मचारी उधार सूची" }
    };
    
    // ===== STATE =====
    let workers = [];
    let transactions = [];
    let currentLang = 'en';
    let isDark = false;
    
    // ===== UTILITY FUNCTIONS =====
    function $(id) { return document.getElementById(id); }
    
    function showLoader(show = true) {
      $('loadAnim').classList[show ? 'add' : 'remove']('active');
    }
    
    function NOW() { return new Date().toISOString().split('T')[0]; }
    
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-IN', { 
        style: 'currency', 
        currency: 'INR',
        maximumFractionDigits: 0
      }).format(amount || 0);
    }
    
    function showMessage(msg, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
      };
      
      notification.innerHTML = `
        <div class="notification-content">
          <span class="notification-icon">${icons[type] || icons.info}</span>
          <span class="notification-message">${msg}</span>
          <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }
    
    // ===== DATA MANAGEMENT =====
    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try {
          const data = JSON.parse(raw);
          workers = data.workers || [];
          transactions = data.transactions || [];
        } catch (e) {
          console.error('Error loading data:', e);
          workers = [];
          transactions = [];
        }
      }
    }
    
    function saveData() {
      const data = {
        version: '3.0',
        appName: 'Karigar Upad Yadi',
        exportedAt: new Date().toISOString(),
        workers,
        transactions
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    
    // ===== LANGUAGE & THEME =====
    function setLanguage(lang) {
      currentLang = lang;
      document.body.style.fontFamily = LANGS[lang].font;
      $('app-title').textContent = LANGS[lang].title;
      localStorage.setItem(LANG_KEY, lang);
    }
    
    function toggleTheme() {
      isDark = !isDark;
      document.body.classList.toggle('dark', isDark);
      $('theme-toggle').textContent = isDark ? '☀️' : '🌙';
      localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
    }
    
    function updateLiveClock() {
      const clock = $('live-clock');
      if (clock) {
        clock.textContent = new Date().toLocaleTimeString('en-IN', { 
          hour: '2-digit', 
          minute: '2-digit', 
          second: '2-digit' 
        });
      }
    }
    
    // ===== TAB MANAGEMENT =====
    function showTab(tabName) {
      const tabs = document.querySelectorAll('.tab-content');
      const btns = document.querySelectorAll('.tab-btn');
      
      tabs.forEach(tab => tab.classList.remove('active'));
      btns.forEach(btn => btn.classList.remove('active'));
      
      $(tabName).classList.add('active');
      event.target.classList.add('active');
      
      if (tabName === 'dashboard') updateDashboard();
      else if (tabName === 'workers') displayWorkers();
    }
    
    // ===== WORKER MANAGEMENT =====
    function addWorker() {
      showLoader(true);
      
      setTimeout(() => {
        const name = $('workerName').value.trim();
        const phone = $('workerPhone').value.trim();
        const address = $('workerAddress').value.trim();
        const idType = $('idProofType').value;
        const idNumber = $('idNumber').value.trim();
        const notes = $('workerNotes').value.trim();
        
        if (!name || !phone) {
          showMessage('⚠️ Name and Phone Number are required!', 'warning');
          showLoader(false);
          return;
        }
        
        const worker = {
          id: Date.now(),
          name,
          phone,
          address,
          idType,
          idNumber,
          notes,
          totalLent: 0,
          totalReceived: 0,
          totalDeducted: 0,
          pending: 0,
          createdDate: NOW()
        };
        
        workers.push(worker);
        saveData();
        
        // Clear form
        $('workerName').value = '';
        $('workerPhone').value = '';
        $('workerAddress').value = '';
        $('idProofType').value = '';
        $('idNumber').value = '';
        $('workerNotes').value = '';
        
        updateWorkerSelects();
        updateDashboard();
        
        showMessage('✅ Worker added successfully!', 'success');
        showLoader(false);
      }, 300);
    }
    
    function quickAddWorker() {
      showTab('addWorker');
      document.querySelector('.tab-btn[onclick*="addWorker"]').classList.add('active');
      $('workerName').focus();
    }
    
    function updateWorkerSelects() {
      const selects = [
        $('lendWorkerSelect'),
        $('receiveWorkerSelect'),
        $('deductWorkerSelect'),
        $('reportWorkerSelect')
      ];
      
      selects.forEach(select => {
        if (!select) return;
        
        const isReceive = select.id === 'receiveWorkerSelect';
        select.innerHTML = '<option value="">Choose a worker...</option>';
        
        workers.forEach(worker => {
          const option = document.createElement('option');
          option.value = worker.id;
          option.textContent = isReceive 
            ? `${worker.name} - Pending: ${formatCurrency(worker.pending)}`
            : `${worker.name} (${worker.phone})`;
          select.appendChild(option);
        });
      });
    }
    
    function displayWorkers() {
      const workerList = $('workerList');
      
      if (workers.length === 0) {
        workerList.innerHTML = `
          <div class="empty-state">
            <p style="font-size: 60px;">📋</p>
            <h3>No Workers Added Yet</h3>
            <p>Click the "+" button or "Add" tab to create your first worker record</p>
          </div>
        `;
        return;
      }
      
      workerList.innerHTML = workers.map(worker => `
        <div class="worker-card" onclick="showWorkerDetails(${worker.id})">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <h3>${worker.name}</h3>
            <span class="badge ${worker.pending > 0 ? 'danger' : 'success'}">
              ${worker.pending > 0 ? 'Pending' : 'Clear'}
            </span>
          </div>
          <div class="worker-info">
            <div class="info-item">
              <span class="info-label">Phone:</span>
              <span class="info-value">${worker.phone}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Total Lent:</span>
              <span class="info-value">${formatCurrency(worker.totalLent)}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Received:</span>
              <span class="info-value">${formatCurrency(worker.totalReceived)}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Pending:</span>
              <span class="info-value" style="color: ${worker.pending > 0 ? 'var(--accent-red)' : 'var(--accent-green)'}">
                ${formatCurrency(worker.pending)}
              </span>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function filterWorkers() {
      const searchTerm = $('searchWorker').value.toLowerCase();
      const filteredWorkers = workers.filter(worker => 
        worker.name.toLowerCase().includes(searchTerm) ||
        worker.phone.includes(searchTerm) ||
        (worker.address && worker.address.toLowerCase().includes(searchTerm))
      );
      
      const workerList = $('workerList');
      
      if (filteredWorkers.length === 0) {
        workerList.innerHTML = `
          <div class="empty-state">
            <p style="font-size: 60px;">🔍</p>
            <h3>No Results Found</h3>
            <p>Try searching with a different term</p>
          </div>
        `;
        return;
      }
      
      workerList.innerHTML = filteredWorkers.map(worker => `
        <div class="worker-card" onclick="showWorkerDetails(${worker.id})">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <h3>${worker.name}</h3>
            <span class="badge ${worker.pending > 0 ? 'danger' : 'success'}">
              ${worker.pending > 0 ? 'Pending' : 'Clear'}
            </span>
          </div>
          <div class="worker-info">
            <div class="info-item">
              <span class="info-label">Phone:</span>
              <span class="info-value">${worker.phone}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Total Lent:</span>
              <span class="info-value">${formatCurrency(worker.totalLent)}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Received:</span>
              <span class="info-value">${formatCurrency(worker.totalReceived)}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Pending:</span>
              <span class="info-value" style="color: ${worker.pending > 0 ? 'var(--accent-red)' : 'var(--accent-green)'}">
                ${formatCurrency(worker.pending)}
              </span>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function showWorkerDetails(workerId) {
      const worker = workers.find(w => w.id === workerId);
      if (!worker) return;
      
      const workerTransactions = transactions.filter(t => t.workerId === workerId)
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      
      let modalHtml = `
        <div style="background: var(--brand-light); padding: 20px; border-radius: 14px; margin-bottom: 20px;">
          <h3 style="color: var(--brand-blue); margin-bottom: 14px;">${worker.name}</h3>
          <p><strong>Phone:</strong> ${worker.phone}</p>
          ${worker.address ? `<p><strong>Address:</strong> ${worker.address}</p>` : ''}
          ${worker.idType ? `<p><strong>ID:</strong> ${worker.idType} - ${worker.idNumber}</p>` : ''}
          ${worker.notes ? `<p><strong>Notes:</strong> ${worker.notes}</p>` : ''}
          <p><strong>Created:</strong> ${worker.createdDate}</p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 22px;">
          <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px; border-radius: 14px; text-align: center;">
            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">Total Lent</div>
            <div style="font-size: 22px; font-weight: 700;">${formatCurrency(worker.totalLent)}</div>
          </div>
          <div style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px; border-radius: 14px; text-align: center;">
            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">Total Received</div>
            <div style="font-size: 22px; font-weight: 700;">${formatCurrency(worker.totalReceived)}</div>
          </div>
          <div style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 16px; border-radius: 14px; text-align: center;">
            <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">Pending</div>
            <div style="font-size: 22px; font-weight: 700;">${formatCurrency(worker.pending)}</div>
          </div>
        </div>
        
        <h3 style="margin-bottom: 14px;">Transaction History</h3>
      `;
      
      if (workerTransactions.length > 0) {
        modalHtml += `
          <div style="overflow-x: auto;">
            <table class="transaction-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody>
                ${workerTransactions.map(t => `
                  <tr>
                    <td>${t.date}</td>
                    <td><span class="badge ${t.type === 'lent' ? 'danger' : t.type === 'received' ? 'success' : 'warning'}">
                      ${t.type === 'lent' ? '💸 Lent' : t.type === 'received' ? '✅ Received' : '🔻 Adjusted'}
                    </span></td>
                    <td style="font-weight: 700; color: ${t.type === 'lent' ? 'var(--accent-red)' : 'var(--accent-green)'}">
                      ${formatCurrency(t.amount)}
                    </td>
                    <td>${t.purpose || t.method || t.note || '-'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      } else {
        modalHtml += `<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No transactions yet</p>`;
      }
      
      modalHtml += `
        <div class="action-buttons" style="margin-top: 22px;">
          <button class="btn btn-danger" onclick="deleteWorker(${worker.id})">🗑️ Delete Worker</button>
          <button class="btn btn-secondary" onclick="closeModal()">Close</button>
        </div>
      `;
      
      $('modalContent').innerHTML = modalHtml;
      $('workerModal').classList.add('active');
    }
    
    function closeModal() {
      $('workerModal').classList.remove('active');
    }
    
    function deleteWorker(workerId) {
      if (!confirm('⚠️ Are you sure? All transactions will also be deleted.')) {
        return;
      }
      
      workers = workers.filter(w => w.id !== workerId);
      transactions = transactions.filter(t => t.workerId !== workerId);
      
      saveData();
      closeModal();
      displayWorkers();
      updateDashboard();
      updateWorkerSelects();
      
      showMessage('✅ Worker deleted successfully!', 'success');
    }
    
    // ===== TRANSACTION MANAGEMENT =====
    function lendMoney() {
      showLoader(true);
      
      setTimeout(() => {
        const workerId = parseInt($('lendWorkerSelect').value);
        const amount = parseFloat($('lendAmount').value);
        const date = $('lendDate').value;
        const dueDate = $('lendDueDate').value;
        const purpose = $('lendPurpose').value.trim();
        const notes = $('lendNotes').value.trim();
        
        if (!workerId || !amount || !date) {
          showMessage('⚠️ Please fill all required fields!', 'warning');
          showLoader(false);
          return;
        }
        
        const transaction = {
          id: Date.now(),
          workerId,
          type: 'lent',
          amount,
          date,
          dueDate,
          purpose,
          notes
        };
        
        transactions.push(transaction);
        
        const worker = workers.find(w => w.id === workerId);
        worker.totalLent += amount;
        worker.pending += amount;
        
        saveData();
        
        // Clear form
        $('lendWorkerSelect').value = '';
        $('lendAmount').value = '';
        $('lendDueDate').value = '';
        $('lendPurpose').value = '';
        $('lendNotes').value = '';
        
        updateDashboard();
        
        showMessage('✅ Money lent successfully!', 'success');
        showLoader(false);
      }, 300);
    }
    
    function receiveMoney() {
      showLoader(true);
      
      setTimeout(() => {
        const workerId = parseInt($('receiveWorkerSelect').value);
        const amount = parseFloat($('receiveAmount').value);
        const date = $('receiveDate').value;
        const method = $('paymentMethod').value;
        const notes = $('receiveNotes').value.trim();
        
        if (!workerId || !amount || !date) {
          showMessage('⚠️ Please fill all required fields!', 'warning');
          showLoader(false);
          return;
        }
        
        const worker = workers.find(w => w.id === workerId);
        
        if (amount > worker.pending) {
          if (!confirm(`⚠️ Amount (${formatCurrency(amount)}) exceeds pending balance (${formatCurrency(worker.pending)}). Continue?`)) {
            showLoader(false);
            return;
          }
        }
        
        const transaction = {
          id: Date.now(),
          workerId,
          type: 'received',
          amount,
          date,
          method,
          notes
        };
        
        transactions.push(transaction);
        
        worker.totalReceived += amount;
        worker.pending -= amount;
        
        saveData();
        
        // Clear form
        $('receiveWorkerSelect').value = '';
        $('receiveAmount').value = '';
        $('receiveNotes').value = '';
        $('balanceInfo').style.display = 'none';
        
        updateDashboard();
        
        showMessage('✅ Money received successfully!', 'success');
        showLoader(false);
      }, 300);
    }
    
    function showWorkerBalance() {
      const workerId = parseInt($('receiveWorkerSelect').value);
      if (workerId) {
        const worker = workers.find(w => w.id === workerId);
        $('workerBalance').textContent = formatCurrency(worker.pending).replace('₹', '');
        $('balanceInfo').style.display = 'block';
      } else {
        $('balanceInfo').style.display = 'none';
      }
    }
    
    function doDeduct() {
      showLoader(true);
      
      setTimeout(() => {
        const workerId = parseInt($('deductWorkerSelect').value);
        const amount = parseFloat($('deductAmount').value);
        const date = $('deductDate').value;
        const opt = $('deductOpt').value;
        const note = $('deductNote').value.trim();
        
        if (!workerId || !amount || !date) {
          showMessage('⚠️ Please fill all required fields!', 'warning');
          showLoader(false);
          return;
        }
        
        const transaction = {
          id: Date.now(),
          workerId,
          type: 'deduct',
          amount,
          date,
          note,
          opt
        };
        
        transactions.push(transaction);
        
        const worker = workers.find(w => w.id === workerId);
        
        if (opt === 'decrease') {
          worker.totalDeducted += amount;
          worker.pending -= amount;
        } else if (opt === 'increase') {
          worker.totalLent += amount;
          worker.pending += amount;
        }
        
        saveData();
        
        // Clear form
        $('deductWorkerSelect').value = '';
        $('deductAmount').value = '';
        $('deductNote').value = '';
        
        updateDashboard();
        
        showMessage('✅ Adjustment applied successfully!', 'success');
        showLoader(false);
      }, 300);
    }
    
    // ===== DASHBOARD =====
    function updateDashboard() {
      const totalWorkers = workers.length;
      const totalLent = workers.reduce((sum, w) => sum + w.totalLent, 0);
      const totalPending = workers.reduce((sum, w) => sum + w.pending, 0);
      const totalReceived = workers.reduce((sum, w) => sum + w.totalReceived, 0);
      
      $('totalWorkers').textContent = totalWorkers;
      $('totalLent').textContent = formatCurrency(totalLent).replace('₹', '');
      $('totalPending').textContent = formatCurrency(totalPending).replace('₹', '');
      $('totalReceived').textContent = formatCurrency(totalReceived).replace('₹', '');
      
      updateChart();
      updateRecentTransactions();
    }
    
    function updateChart() {
      const topWorkers = [...workers]
        .filter(w => w.pending > 0)
        .sort((a, b) => b.pending - a.pending)
        .slice(0, 5);
      
      const chart = $('topWorkersChart');
      
      if (topWorkers.length === 0) {
        chart.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 50px;">No pending amounts 🎉</p>';
        return;
      }
      
      const maxPending = Math.max(...topWorkers.map(w => w.pending));
      
      chart.innerHTML = topWorkers.map(worker => {
        const height = (worker.pending / maxPending) * 100;
        return `
          <div class="bar" style="height: ${height}%">
            <div class="bar-value">${formatCurrency(worker.pending)}</div>
            <div class="bar-label">${worker.name.split(' ')[0]}</div>
          </div>
        `;
      }).join('');
    }
    
    function updateRecentTransactions() {
      const recent = [...transactions]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 10);
      
      const tbody = $('recentTransactions');
      
      if (recent.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-secondary);">No transactions yet</td></tr>';
        return;
      }
      
      tbody.innerHTML = recent.map(t => {
        const worker = workers.find(w => w.id === t.workerId);
        const badgeClass = t.type === 'lent' ? 'danger' : t.type === 'received' ? 'success' : 'warning';
        const icon = t.type === 'lent' ? '💸' : t.type === 'received' ? '✅' : '🔻';
        
        return `
          <tr>
            <td>${t.date}</td>
            <td>${worker ? worker.name : 'Unknown'}</td>
            <td><span class="badge ${badgeClass}">${icon} ${t.type}</span></td>
            <td style="font-weight: 700; color: ${t.type === 'lent' ? 'var(--accent-red)' : 'var(--accent-green)'}">
              ${formatCurrency(t.amount)}
            </td>
          </tr>
        `;
      }).join('');
    }
    
    // ===== REPORTS =====
    function generateReport() {
      showLoader(true);
      
      setTimeout(() => {
        const reportType = $('reportType').value;
        const fromDate = $('reportFromDate').value;
        const toDate = $('reportToDate').value;
        const reportContent = $('reportContent');
        
        let html = '';
        
        if (reportType === 'all') {
          html = generateAllWorkersReport(fromDate, toDate);
        } else if (reportType === 'single') {
          const workerId = parseInt($('reportWorkerSelect').value);
          if (!workerId) {
            showMessage('⚠️ Please select a worker!', 'warning');
            showLoader(false);
            return;
          }
          html = generateSingleWorkerReport(workerId, fromDate, toDate);
        } else if (reportType === 'pending') {
          html = generatePendingReport();
        } else if (reportType === 'transactions') {
          html = generateTransactionsReport(fromDate, toDate);
        }
        
        reportContent.innerHTML = html;
        showLoader(false);
      }, 400);
    }
    
    function generateAllWorkersReport(fromDate, toDate) {
      let html = `
        <div class="chart-container">
          <h2>All Workers Summary Report</h2>
          <p style="color: var(--text-secondary); margin-bottom: 18px;">Generated: ${new Date().toLocaleString()}</p>
          
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Worker</th>
                <th>Phone</th>
                <th>Lent (₹)</th>
                <th>Received (₹)</th>
                <th>Pending (₹)</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      workers.forEach(worker => {
        html += `
          <tr>
            <td><strong>${worker.name}</strong></td>
            <td>${worker.phone}</td>
            <td>${formatCurrency(worker.totalLent)}</td>
            <td>${formatCurrency(worker.totalReceived)}</td>
            <td style="font-weight: 700; color: ${worker.pending > 0 ? 'var(--accent-red)' : 'var(--accent-green)'}">
              ${formatCurrency(worker.pending)}
            </td>
            <td><span class="badge ${worker.pending > 0 ? 'danger' : 'success'}">
              ${worker.pending > 0 ? 'Pending' : 'Clear'}
            </span></td>
          </tr>
        `;
      });
      
      const totalLent = workers.reduce((sum, w) => sum + w.totalLent, 0);
      const totalReceived = workers.reduce((sum, w) => sum + w.totalReceived, 0);
      const totalPending = workers.reduce((sum, w) => sum + w.pending, 0);
      
      html += `
            <tr style="background: var(--brand-light); font-weight: 700;">
              <td colspan="2">TOTAL</td>
              <td>${formatCurrency(totalLent)}</td>
              <td>${formatCurrency(totalReceived)}</td>
              <td style="color: var(--accent-red)">${formatCurrency(totalPending)}</td>
              <td>-</td>
            </tr>
          </tbody>
        </table>
      </div>
      `;
      
      return html;
    }
    
    function generateSingleWorkerReport(workerId, fromDate, toDate) {
      const worker = workers.find(w => w.id === workerId);
      let workerTransactions = transactions.filter(t => t.workerId === workerId);
      
      if (fromDate) workerTransactions = workerTransactions.filter(t => t.date >= fromDate);
      if (toDate) workerTransactions = workerTransactions.filter(t => t.date <= toDate);
      
      workerTransactions.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      let html = `
        <div class="chart-container">
          <h2>Worker Report: ${worker.name}</h2>
          <p style="color: var(--text-secondary); margin-bottom: 18px;">Generated: ${new Date().toLocaleString()}</p>
          
          <div style="background: var(--brand-light); padding: 18px; border-radius: 12px; margin-bottom: 20px;">
            <p><strong>Phone:</strong> ${worker.phone}</p>
            ${worker.address ? `<p><strong>Address:</strong> ${worker.address}</p>` : ''}
            ${worker.idType ? `<p><strong>ID:</strong> ${worker.idType} - ${worker.idNumber}</p>` : ''}
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 14px; margin-bottom: 20px;">
            <div style="background: var(--brand-light); padding: 18px; border-radius: 12px; text-align: center;">
              <div style="color: var(--text-secondary); margin-bottom: 6px;">Total Lent</div>
              <div style="font-size: 26px; font-weight: 700; color: var(--brand-blue);">${formatCurrency(worker.totalLent)}</div>
            </div>
            <div style="background: var(--brand-light); padding: 18px; border-radius: 12px; text-align: center;">
              <div style="color: var(--text-secondary); margin-bottom: 6px;">Received</div>
              <div style="font-size: 26px; font-weight: 700; color: var(--accent-green);">${formatCurrency(worker.totalReceived)}</div>
            </div>
            <div style="background: var(--brand-light); padding: 18px; border-radius: 12px; text-align: center;">
              <div style="color: var(--text-secondary); margin-bottom: 6px;">Pending</div>
              <div style="font-size: 26px; font-weight: 700; color: var(--accent-red);">${formatCurrency(worker.pending)}</div>
            </div>
          </div>
          
          <h3 style="margin-bottom: 14px;">Transaction History</h3>
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount (₹)</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      if (workerTransactions.length > 0) {
        workerTransactions.forEach(t => {
          const badgeClass = t.type === 'lent' ? 'danger' : t.type === 'received' ? 'success' : 'warning';
          const icon = t.type === 'lent' ? '💸' : t.type === 'received' ? '✅' : '🔻';
          
          html += `
            <tr>
              <td>${t.date}</td>
              <td><span class="badge ${badgeClass}">${icon} ${t.type}</span></td>
              <td style="font-weight: 700; color: ${t.type === 'lent' ? 'var(--accent-red)' : 'var(--accent-green)'}">
                ${formatCurrency(t.amount)}
              </td>
              <td>${t.purpose || t.method || t.note || '-'}</td>
            </tr>
          `;
        });
      } else {
        html += '<tr><td colspan="4" style="text-align: center; color: var(--text-secondary);">No transactions found</td></tr>';
      }
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      return html;
    }
    
    function generatePendingReport() {
      const pendingWorkers = workers.filter(w => w.pending > 0)
        .sort((a, b) => b.pending - a.pending);
      
      let html = `
        <div class="chart-container">
          <h2>Workers with Pending Amount</h2>
          <p style="color: var(--text-secondary); margin-bottom: 18px;">Generated: ${new Date().toLocaleString()}</p>
          
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Worker</th>
                <th>Phone</th>
                <th>Pending (₹)</th>
                <th>Lent (₹)</th>
                <th>Received (₹)</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      if (pendingWorkers.length > 0) {
        pendingWorkers.forEach(worker => {
          html += `
            <tr>
              <td><strong>${worker.name}</strong></td>
              <td>${worker.phone}</td>
              <td style="font-weight: 700; color: var(--accent-red);">${formatCurrency(worker.pending)}</td>
              <td>${formatCurrency(worker.totalLent)}</td>
              <td>${formatCurrency(worker.totalReceived)}</td>
            </tr>
          `;
        });
        
        const totalPending = pendingWorkers.reduce((sum, w) => sum + w.pending, 0);
        
        html += `
          <tr style="background: var(--brand-light); font-weight: 700;">
            <td colspan="2">TOTAL PENDING</td>
            <td style="color: var(--accent-red);">${formatCurrency(totalPending)}</td>
            <td colspan="2">-</td>
          </tr>
        `;
      } else {
        html += '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No pending amounts! 🎉</td></tr>';
      }
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      return html;
    }
    
    function generateTransactionsReport(fromDate, toDate) {
      let allTransactions = [...transactions];
      
      if (fromDate) allTransactions = allTransactions.filter(t => t.date >= fromDate);
      if (toDate) allTransactions = allTransactions.filter(t => t.date <= toDate);
      
      allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      let html = `
        <div class="chart-container">
          <h2>All Transactions Report</h2>
          <p style="color: var(--text-secondary); margin-bottom: 18px;">
            Generated: ${new Date().toLocaleString()}
            ${fromDate && toDate ? ` | Period: ${fromDate} to ${toDate}` : ''}
          </p>
          
          <table class="transaction-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Worker</th>
                <th>Type</th>
                <th>Amount (₹)</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      if (allTransactions.length > 0) {
        allTransactions.forEach(t => {
          const worker = workers.find(w => w.id === t.workerId);
          const badgeClass = t.type === 'lent' ? 'danger' : t.type === 'received' ? 'success' : 'warning';
          const icon = t.type === 'lent' ? '💸' : t.type === 'received' ? '✅' : '🔻';
          
          html += `
            <tr>
              <td>${t.date}</td>
              <td>${worker ? worker.name : 'Unknown'}</td>
              <td><span class="badge ${badgeClass}">${icon} ${t.type}</span></td>
              <td style="font-weight: 700; color: ${t.type === 'lent' ? 'var(--accent-red)' : 'var(--accent-green)'}">
                ${formatCurrency(t.amount)}
              </td>
              <td>${t.purpose || t.method || t.note || '-'}</td>
            </tr>
          `;
        });
        
        const totalLent = allTransactions.filter(t => t.type === 'lent')
          .reduce((sum, t) => sum + t.amount, 0);
        const totalReceived = allTransactions.filter(t => t.type === 'received')
          .reduce((sum, t) => sum + t.amount, 0);
        
        html += `
          <tr style="background: var(--brand-light); font-weight: 700;">
            <td colspan="2">SUMMARY</td>
            <td>Lent: ${allTransactions.filter(t => t.type === 'lent').length} | Received: ${allTransactions.filter(t => t.type === 'received').length}</td>
            <td>Lent: ${formatCurrency(totalLent)}<br>Received: ${formatCurrency(totalReceived)}</td>
            <td>-</td>
          </tr>
        `;
      } else {
        html += '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No transactions found</td></tr>';
      }
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      return html;
    }
    
    function printReport() {
      const reportContent = $('reportContent').innerHTML;
      
      if (!reportContent) {
        showMessage('⚠️ Please generate a report first!', 'warning');
        return;
      }
      
      const printSection = $('printSection');
      printSection.innerHTML = `
        <div style="padding: 40px; font-family: Arial, sans-serif;">
          <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px;">
            <h1 style="color: #667eea; margin-bottom: 8px;">કારિગર ઉપાડ યાદી</h1>
            <p style="color: #64748b; font-size: 14px;">Karigar Upad Yadi | Worker Money Lending Record System</p>
            <p style="color: #64748b; font-size: 13px; margin-top: 8px;">Made by Ved Mangukiya | © 2025 All Rights Reserved</p>
          </div>
          ${reportContent}
          <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; color: #64748b; font-size: 12px;">
            <p>Generated by Karigar Upad Yadi — Made by Ved Mangukiya</p>
            <p style="margin-top: 5px;">© 2025 Mangukiya Ved. All Rights Reserved.</p>
          </div>
        </div>
      `;
      
      window.print();
    }
    
    function downloadPDF() {
      showLoader(true);
      
      setTimeout(() => {
        const reportContent = $('reportContent').innerHTML;
        
        if (!reportContent) {
          showMessage('⚠️ Please generate a report first!', 'warning');
          showLoader(false);
          return;
        }
        
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          unit: 'pt',
          format: 'a4'
        });
        
        // Header with better styling
        pdf.setFontSize(22);
        pdf.setTextColor(37, 99, 235);
        pdf.text('કારિગર ઉપાડ યાદી', 40, 50);
        
        pdf.setFontSize(14);
        pdf.setTextColor(100, 116, 139);
        pdf.text('Karigar Upad Yadi | Worker Money Lending Record System', 40, 75);
        pdf.text('Made by Ved Mangukiya | © 2025 All Rights Reserved', 40, 90);
        
        // Report Type and Date Range
        const reportType = $('reportType').value;
        const fromDate = $('reportFromDate').value;
        const toDate = $('reportToDate').value;
        
        pdf.setFontSize(16);
        pdf.setTextColor(37, 99, 235);
        pdf.text(`Report: ${reportType.charAt(0).toUpperCase() + reportType.slice(1)}`, 40, 115);
        
        if (fromDate && toDate) {
          pdf.setFontSize(12);
          pdf.setTextColor(100, 116, 139);
          pdf.text(`Date Range: ${fromDate} to ${toDate}`, 40, 135);
        }
        
        pdf.setFontSize(11);
        pdf.setTextColor(64, 64, 64);
        pdf.text(`Generated: ${new Date().toLocaleString()}`, 40, 150);
        
        // Data with proper formatting
        let yPos = 170;
        
        if (reportType === 'all' || reportType === 'pending') {
          const targetWorkers = reportType === 'all' ? workers : workers.filter(w => w.pending > 0);
          
          if (targetWorkers.length === 0) {
            pdf.setFontSize(14);
            pdf.setTextColor(100, 116, 139);
            pdf.text('No data available', 40, yPos);
          } else {
            pdf.autoTable({
              startY: yPos,
              head: [['Worker Name', 'Phone', 'Total Lent (₹)', 'Total Received (₹)', 'Pending (₹)']],
              body: targetWorkers.map(w => [
                w.name,
                w.phone,
                formatCurrency(w.totalLent).replace('₹', ''),
                formatCurrency(w.totalReceived).replace('₹', ''),
                formatCurrency(w.pending).replace('₹', '')
              ]),
              theme: 'grid',
              headStyles: { 
                fillColor: [37, 99, 235],
                textColor: [255, 255, 255],
                fontStyle: 'bold'
              },
              styles: { 
                fontSize: 10,
                cellPadding: 6
              },
              alternateRowStyles: {
                fillColor: [248, 250, 252]
              },
              columnStyles: {
                2: { halign: 'right' },
                3: { halign: 'right' },
                4: { halign: 'right' }
              }
            });
          }
        } else if (reportType === 'transactions') {
          let allTransactions = [...transactions];
          
          if (fromDate) allTransactions = allTransactions.filter(t => t.date >= fromDate);
          if (toDate) allTransactions = allTransactions.filter(t => t.date <= toDate);
          
          allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
          
          if (allTransactions.length === 0) {
            pdf.setFontSize(14);
            pdf.setTextColor(100, 116, 139);
            pdf.text('No transactions found for the selected period', 40, yPos);
          } else {
            pdf.autoTable({
              startY: yPos,
              head: [['Date', 'Worker', 'Type', 'Amount (₹)', 'Details']],
              body: allTransactions.map(t => {
                const worker = workers.find(w => w.id === t.workerId);
                return [
                  t.date,
                  worker ? worker.name : 'Unknown',
                  t.type,
                  formatCurrency(t.amount).replace('₹', ''),
                  t.purpose || t.method || t.note || '-'
                ];
              }),
              theme: 'grid',
              headStyles: { 
                fillColor: [37, 99, 235],
                textColor: [255, 255, 255],
                fontStyle: 'bold'
              },
              styles: { 
                fontSize: 10,
                cellPadding: 6
              },
              alternateRowStyles: {
                fillColor: [248, 250, 252]
              },
              columnStyles: {
                3: { halign: 'right' }
              }
            });
          }
        }
        
        // Footer on each page
        const pageCount = pdf.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          pdf.setPage(i);
          pdf.setFontSize(9);
          pdf.setTextColor(120, 120, 120);
          pdf.text('Made by Ved Mangukiya | © 2025 Mangukiya Ved', 40, pdf.internal.pageSize.height - 20);
        }
        
        pdf.save(`Karigar-Upad-Report-${NOW()}.pdf`);
        showMessage('✅ PDF generated successfully!', 'success');
        showLoader(false);
      }, 500);
    }
    
    // ===== IMPORT/EXPORT =====
    function exportJSON() {
      showLoader(true);
      
      setTimeout(() => {
        const data = {
          version: '3.0',
          appName: 'Karigar Upad Yadi',
          exportedAt: new Date().toISOString(),
          exportedBy: 'Ved Mangukiya',
          workers,
          transactions
        };
        
        const jsonStr = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `karigar-Upad-backup-${NOW()}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showMessage('✅ Data exported successfully!', 'success');
        showLoader(false);
      }, 400);
    }
    
    function importJSON(event) {
      showLoader(true);
      
      const file = event.target.files[0];
      if (!file) {
        showLoader(false);
        return;
      }
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Validate structure
          if (!data.workers || !Array.isArray(data.workers)) {
            throw new Error('Invalid data format: missing workers array');
          }
          
          if (!data.transactions || !Array.isArray(data.transactions)) {
            throw new Error('Invalid data format: missing transactions array');
          }
          
          // Confirm import
          if (!confirm(`⚠️ This will replace ALL current data with imported data.\n\nImporting ${data.workers.length} workers and ${data.transactions.length} transactions.\n\nContinue?`)) {
            showLoader(false);
            return;
          }
          
          // Import data
          workers = data.workers;
          transactions = data.transactions;
          
          saveData();
          updateDashboard();
          updateWorkerSelects();
          displayWorkers();
          
          showMessage(`✅ Successfully imported ${workers.length} workers and ${transactions.length} transactions!`, 'success');
          showLoader(false);
          
        } catch (error) {
          console.error('Import error:', error);
          showMessage('❌ Error importing data: ' + error.message, 'error');
          showLoader(false);
        }
      };
      
      reader.onerror = function() {
        showMessage('❌ Error reading file', 'error');
        showLoader(false);
      };
      
      reader.readAsText(file);
      
      // Reset input
      event.target.value = '';
    }
    
    function exportCSV() {
      showLoader(true);
      
      setTimeout(() => {
        const csvRows = [];
        csvRows.push(['Worker Name', 'Phone', 'Date', 'Type', 'Amount', 'Details', 'Pending Balance'].join(','));
        
        transactions.forEach(t => {
          const worker = workers.find(w => w.id === t.workerId);
          if (worker) {
            const row = [
              `"${worker.name}"`,
              `"${worker.phone}"`,
              t.date,
              t.type,
              t.amount,
              `"${t.purpose || t.method || t.note || '-'}"`,
              worker.pending
            ];
            csvRows.push(row.join(','));
          }
        });
        
        const csvStr = csvRows.join('\n');
        const blob = new Blob([csvStr], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `karigar-Upad-data-${NOW()}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showMessage('✅ CSV exported successfully!', 'success');
        showLoader(false);
      }, 400);
    }
    
    function clearAllData() {
      if (!confirm('⚠️⚠️⚠️ WARNING!\n\nThis will DELETE ALL DATA permanently!\n\nThis action CANNOT be undone.\n\nType "DELETE ALL" in the next prompt to confirm.')) {
        return;
      }
      
      const confirmation = prompt('Type "DELETE ALL" to confirm:');
      
      if (confirmation === 'DELETE ALL') {
        workers = [];
        transactions = [];
        saveData();
        
        updateDashboard();
        updateWorkerSelects();
        displayWorkers();
        
        showMessage('✅ All data cleared!', 'info');
      } else {
        showMessage('❌ Deletion cancelled', 'info');
      }
    }
    
    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      // Load data
      loadData();
      
      // Set dates
      const today = NOW();
      $('lendDate').value = today;
      $('receiveDate').value = today;
      $('deductDate').value = today;
      
      // Language
      const savedLang = localStorage.getItem(LANG_KEY) || 'en';
      currentLang = savedLang;
      $('language-switcher').value = savedLang;
      setLanguage(savedLang);
      
      // Theme
      const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
      isDark = savedTheme === 'dark';
      document.body.classList.toggle('dark', isDark);
      $('theme-toggle').textContent = isDark ? '☀️' : '🌙';
      
      // Event listeners
      $('language-switcher').addEventListener('change', (e) => setLanguage(e.target.value));
      $('theme-toggle').addEventListener('click', toggleTheme);
      
      $('reportType').addEventListener('change', function() {
        const singleWorkerDiv = $('singleWorkerReport');
        singleWorkerDiv.style.display = this.value === 'single' ? 'block' : 'none';
      });
      
      // Initial update
      updateDashboard();
      updateWorkerSelects();
      displayWorkers();
      
      // Clock
      setInterval(updateLiveClock, 1000);
      updateLiveClock();
    });
  </script>
</body>
</html>
